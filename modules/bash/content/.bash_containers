#!/bin/bash

postgres() {
    docker run  \
    --rm \
    -d \
    -p 5433:5432 \
    -e POSTGRES_USER=sa \
    -e POSTGRES_PASSWORD=pass \
    -e POSTGRES_DB=db \
    -e PAGER="/usr/bin/less" \
    -e LESS="-X -R -i" \
    -v "$HOME/.local/data/postgres:/usr/local/data" \
    --name postgres \
    postgres:18.1-bookworm

    for i in {1..10}; do
        (echo > /dev/tcp/127.0.0.1/5433) >/dev/null 2>&1 && break
        sleep 0.5
    done

    docker exec -it postgres /bin/bash
    docker stop postgres >/dev/null &
}
